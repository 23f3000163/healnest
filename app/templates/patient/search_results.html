{% extends "layout.html" %}
{% block content %}

<div class="page-container app-page">

    <!-- ================= PAGE HEADER ================= -->
    <div class="page-header">
        <div>
            <h1>Search Results</h1>
            <p class="page-subtitle">
                {% if query %}
                    Showing results for 
                    <span class="fw-semibold text-dark">"{{ query }}"</span>
                {% else %}
                    Browse available doctors
                {% endif %}
            </p>
        </div>

        <div class="page-actions">
            <a href="{{ url_for('patient.dashboard') }}"
               class="btn-app btn-app-outline">
                <i class="fas fa-arrow-left"></i>
                Back to Dashboard
            </a>
        </div>
    </div>


    <!-- ================= RESULTS CARD ================= -->
    <div class="app-card table-card">

        {% set active_doctors = doctors | selectattr("user.is_active") | list %}

        {% if active_doctors %}

        <table class="data-table">
            <thead>
                <tr>
                    <th>Doctor</th>
                    <th>Department</th>
                    <th>Qualifications</th>
                    <th class="text-end">
                        Results ({{ active_doctors|length }})
                    </th>
                </tr>
            </thead>

            <tbody>
                {% for profile in active_doctors %}
                <tr>

                    <!-- DOCTOR -->
                    <td>
                        <div class="row-user">
                            <div class="avatar-circle">
                                {{ profile.full_name[:1]|upper }}
                            </div>
                            <div>
                                <strong>Dr. {{ profile.full_name }}</strong>
                                <div class="text-muted small">
                                    {{ profile.user.email }}
                                </div>
                            </div>
                        </div>
                    </td>

                    <!-- DEPARTMENT -->
                    <td>
                        <span class="dept-pill">
                            {{ profile.department.name if profile.department else "Not Assigned" }}
                        </span>
                    </td>

                    <!-- QUALIFICATIONS -->
                    <td class="text-muted">
                        {{ profile.qualifications or "Qualifications not provided" }}
                    </td>

                    <!-- ACTION -->
                    <td class="text-end">
                        <div class="row-actions">
                            <a href="{{ url_for('patient.doctor_details', doctor_profile_id=profile.id) }}"
                               class="action-btn action-edit">
                                <i class="fas fa-user-md"></i>
                                View
                            </a>

                            <a href="{{ url_for('patient.book_appointment', doctor_profile_id=profile.id) }}"
                               class="action-btn action-activate">
                                <i class="fas fa-calendar-check"></i>
                                Book
                            </a>
                        </div>
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% else %}

            <div class="card-empty text-center">
                <i class="fas fa-search mb-2"></i><br>
                No doctors found matching your search.
            </div>

        {% endif %}

    </div>

</div>

{% endblock %}
