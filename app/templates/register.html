{% extends "layout.html" %}

{% block content %}

<div class="auth-wrapper d-flex justify-content-center align-items-center">
    <div class="auth-card card-glass p-5 shadow-soft">

     
        <div class="text-center mb-4">
            <i class="fa-solid fa-user-plus icon-lg"></i>
            <h2 class="fw-semibold mt-3">Create Your Account</h2>
            <p class="text-muted">Join Healnest and manage your health with ease.</p>
        </div>

      
        <form method="POST" action="">
            {{ form.hidden_tag() }}

          
            <div class="mb-3">
                {{ form.email.label(class="form-label") }}
                {{ form.email(class="form-control form-input-pill", id="emailField", placeholder="name@example.com") }}
                <small id="emailFeedback" class="text-danger d-none">Invalid or already in use</small>
            </div>

         
            <div class="mb-3 position-relative">
                {{ form.password.label(class="form-label") }}
                {{ form.password(class="form-control form-input-pill", id="passwordField", placeholder="Create a strong
                password") }}

                
                <i class="fa-solid fa-eye-slash password-toggle" id="togglePassword"></i>

                
                <div class="password-strength mt-2">
                    <div id="strengthBar"></div>
                </div>
                <small id="passwordHint" class="text-muted">Use 8+ characters, including numbers, uppercase, and
                    symbols.</small>
            </div>

         
            <div class="mb-4">
                {{ form.confirm_password.label(class="form-label") }}
                {{ form.confirm_password(class="form-control form-input-pill", id="confirmField", placeholder="Re-enter
                password") }}
                <small id="confirmFeedback" class="text-danger d-none">Passwords do not match</small>
            </div>

          
            <button id="submitBtn" class="btn-brand w-100 py-2 mb-3" disabled>
                Sign Up
            </button>


        
            <p class="text-center small text-muted">
                Already have an account?
                <a href="{{ url_for('main.login') }}" class="fw-semibold text-primary">Login</a>
            </p>
        </form>
    </div>
</div>

{% endblock %}

{% block scripts %}

<script>
  
    const togglePassword = document.getElementById("togglePassword");
    const passwordField = document.getElementById("passwordField");

    togglePassword.addEventListener("click", () => {
        const type = passwordField.type === "password" ? "text" : "password";
        passwordField.type = type;
        togglePassword.classList.toggle("fa-eye");
        togglePassword.classList.toggle("fa-eye-slash");
    });

   
    const strengthBar = document.getElementById("strengthBar");

    passwordField.addEventListener("input", () => {
        const password = passwordField.value;
        let score = 0;

        if (password.length >= 8) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[0-9]/.test(password)) score++;
        if (/[^A-Za-z0-9]/.test(password)) score++;

        const widthMap = ["15%", "35%", "65%", "100%"];
        const colorMap = ["#C62828", "#ED6C02", "#FFC107", "#2E7D32"];

        strengthBar.style.width = widthMap[score - 1] || "0%";
        strengthBar.style.background = colorMap[score - 1] || "#C62828";
    });

  
    const confirmField = document.getElementById("confirmField");
    const confirmFeedback = document.getElementById("confirmFeedback");

    function validateConfirm() {
        if (!passwordField.value || !confirmField.value) return;

        if (confirmField.value === passwordField.value) {
            confirmField.classList.add("success-border");
            confirmFeedback.classList.add("d-none");
        } else {
            confirmField.classList.remove("success-border");
            confirmFeedback.classList.remove("d-none");
        }
    }
    passwordField.addEventListener("input", validateConfirm);
    confirmField.addEventListener("input", validateConfirm);

    const emailField = document.getElementById("emailField");
    const emailFeedback = document.getElementById("emailFeedback");

    emailField.addEventListener("blur", () => {
        const value = emailField.value;

        if (!value.includes("@") || !value.includes(".")) {
            emailFeedback.innerText = "Invalid email format.";
            emailFeedback.classList.remove("d-none");
            emailField.classList.remove("success-border");
            return;
        }

        
        emailFeedback.classList.add("d-none");
        emailField.classList.add("success-border");
    });

    const submitBtn = document.getElementById("submitBtn");

    setInterval(() => {
        const passwordStrength = parseInt(strengthBar.style.width) || 0;

        const valid =
            emailField.classList.contains("success-border") &&
            confirmField.classList.contains("success-border") &&
            passwordStrength >= 40; 

        submitBtn.disabled = !valid;
        submitBtn.style.opacity = valid ? "1" : ".6";
        submitBtn.style.cursor = valid ? "pointer" : "not-allowed";
    }, 200);

    const formObserver = setInterval(() => {
        if (!submitBtn.disabled) {
            submitBtn.style.opacity = "1";
            submitBtn.style.transform = "scale(1)";
        } else {
            submitBtn.style.opacity = "0.5";
            submitBtn.style.transform = "scale(0.98)";
        }
    }, 200);


</script>

{% endblock %}