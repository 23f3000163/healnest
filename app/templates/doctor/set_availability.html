{% extends "layout.html" %}
{% block content %}

{% set days = days or [] %}
{% set saved_slots = saved_slots or [] %}

<style>
    .slot-label {
        display: block;
        padding: 0.75rem 1rem;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        background-color: #f8f9fa;
        color: #6c757d;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
    }
    .slot-label:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .slot-checkbox:checked + .slot-label {
        background-color: #d1e7dd;
        border-color: #0f5132;
        color: #0f5132;
        font-weight: 500;
    }
    .slot-checkbox {
        display: none;
    }
</style>

<div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Manage Your Weekly Availability</h4>
    </div>
    <div class="card-body">
        <p class="text-muted">
            Set your availability for the next 7 days. Patients can book only during selected slots.
        </p>

        {% if days %}
        <form method="POST">
            <div class="d-flex justify-content-end mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="apply-all-days">
                    <label class="form-check-label" for="apply-all-days">
                        Apply first day’s selection to all
                    </label>
                </div>
            </div>

            <table class="table table-bordered align-middle">
                <thead class="table-light">
                    <tr>
                        <th class="text-center">Date</th>
                        <th class="text-center">Morning (08:00–12:00)</th>
                        <th class="text-center">Evening (16:00–21:00)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for day in days %}
                    <tr>
                        <td class="text-center fw-medium">
                            {{ day.strftime('%a, %d %b %Y') }}
                        </td>

                        <td>
                            {% set m_key = day.isoformat() ~ '_morning' %}
                            <input type="checkbox"
                                   class="slot-checkbox morning-slot"
                                   name="slots"
                                   id="slot-{{ m_key }}"
                                   value="{{ m_key }}"
                                   {% if m_key in saved_slots %}checked{% endif %}>
                            <label class="slot-label" for="slot-{{ m_key }}">
                                08:00 AM – 12:00 PM
                            </label>
                        </td>

                        <td>
                            {% set e_key = day.isoformat() ~ '_evening' %}
                            <input type="checkbox"
                                   class="slot-checkbox evening-slot"
                                   name="slots"
                                   id="slot-{{ e_key }}"
                                   value="{{ e_key }}"
                                   {% if e_key in saved_slots %}checked{% endif %}>
                            <label class="slot-label" for="slot-{{ e_key }}">
                                04:00 PM – 09:00 PM
                            </label>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="text-end mt-4">
                <button type="submit" class="btn btn-success btn-lg">
                    Save Availability
                </button>
            </div>
        </form>
        {% else %}
            <p class="text-muted text-center mb-0">
                Availability cannot be set at this time.
            </p>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const applyAll = document.getElementById('apply-all-days');
    const morningSlots = document.querySelectorAll('.morning-slot');
    const eveningSlots = document.querySelectorAll('.evening-slot');

    if (!applyAll || morningSlots.length === 0) return;

    applyAll.addEventListener('change', function () {
        if (!this.checked) return;

        const firstMorning = morningSlots[0].checked;
        const firstEvening = eveningSlots[0].checked;

        morningSlots.forEach(cb => cb.checked = firstMorning);
        eveningSlots.forEach(cb => cb.checked = firstEvening);
    });
});
</script>

{% endblock content %}
 