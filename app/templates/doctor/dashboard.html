{% extends "layout.html" %}
{% block content %}

<h2 class="mb-4">
    Welcome, Dr. {{ current_user.doctor_profile.full_name }}!
</h2>

<!-- ================= TODAY ================= -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white">
        <h4 class="mb-0">Today</h4>
    </div>
    <div class="card-body">
        {% if today_appointments %}
            <ul class="list-group">
                {% for appt in today_appointments %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span>
                        {{ appt.appointment_datetime.strftime('%I:%M %p') }}
                        — {{ appt.patient.patient_profile.full_name }}
                    </span>
                    <div>
                        <form
                            action="{{ url_for('doctor.complete_appointment', appointment_id=appt.id) }}"
                            method="POST"
                            class="d-inline"
                        >
                            <button class="btn btn-sm btn-success">Complete</button>
                        </form>

                        <form
                            action="{{ url_for('doctor.cancel_appointment', appointment_id=appt.id) }}"
                            method="POST"
                            class="d-inline"
                            onsubmit="return confirm('Cancel this appointment?');"
                        >
                            <button class="btn btn-sm btn-outline-danger">Cancel</button>
                        </form>
                    </div>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted mb-0">No appointments today.</p>
        {% endif %}
    </div>
</div>

<!-- ================= TOMORROW ================= -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white">
        <h4 class="mb-0">Tomorrow</h4>
    </div>
    <div class="card-body">
        {% if tomorrow_appointments %}
            <ul class="list-group">
                {% for appt in tomorrow_appointments %}
                <li class="list-group-item">
                    {{ appt.appointment_datetime.strftime('%I:%M %p') }}
                    — {{ appt.patient.patient_profile.full_name }}
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted mb-0">No appointments tomorrow.</p>
        {% endif %}
    </div>
</div>

<!-- ================= UPCOMING ================= -->
<div class="card shadow-sm">
    <div class="card-header bg-white">
        <h4 class="mb-0">Upcoming</h4>
    </div>
    <div class="card-body">
        {% if future_appointments %}
            {% for day, appts in future_appointments.items() %}
                <h6 class="mt-3">{{ day.strftime('%d %b %Y') }}</h6>
                <ul class="list-group mb-2">
                    {% for appt in appts %}
                    <li class="list-group-item">
                        {{ appt.appointment_datetime.strftime('%I:%M %p') }}
                        — {{ appt.patient.patient_profile.full_name }}
                    </li>
                    {% endfor %}
                </ul>
            {% endfor %}
        {% else %}
            <p class="text-muted mb-0">No upcoming appointments.</p>
        {% endif %}
    </div>
</div>

{% endblock %}
